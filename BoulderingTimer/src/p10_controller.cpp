#include "include/p10_controller.h"
#include <string.h>

#define BUFF_SIZE         64
#define BYTES_IN_GROUP    16
#define GROUP_CNT         (BUFF_SIZE / BYTES_IN_GROUP)

using namespace p10_controller;

static const uint8_t virtual_screen[BUFF_SIZE] = {0};
static const uint8_t sym_table[] = {
  //0
  0b01111111, 0b01100011, 0b01100011, 0b01111111,
  0b01111111, 0b01100011, 0b01100011, 0b01111111,
  0b00000000, 0b01100011, 0b01100011, 0b01100011,
  0b01100011, 0b01100011, 0b01100011, 0b00000000,
  //1
  0b00000011, 0b00000011, 0b00000011, 0b00000011,
  0b00000011, 0b00000011, 0b00000011, 0b00000011,
  0b00000000, 0b00000011, 0b00000011, 0b00000011,
  0b00000011, 0b00000011, 0b00000011, 0b00000000,
  //2
  0b01111111, 0b01100000, 0b00000011, 0b01111111,
  0b01111111, 0b01100000, 0b00000011, 0b01111111,
  0b00000000, 0b01100000, 0b01111111, 0b00000011,
  0b01100000, 0b01111111, 0b00000011, 0b00000000,
  //3
  0b01111111, 0b00000011, 0b00000011, 0b01111111,
  0b01111111, 0b00000011, 0b00000011, 0b01111111,
  0b00000000, 0b00000011, 0b01111111, 0b00000011,
  0b00000011, 0b01111111, 0b00000011, 0b00000000,
  //4
  0b00000011, 0b00000011, 0b01100011, 0b01100011,
  0b00000011, 0b00000011, 0b01100011, 0b01100011,
  0b00000000, 0b00000011, 0b01111111, 0b01100011,
  0b00000011, 0b01111111, 0b01100011, 0b00000000,
  //5
  0b01111111, 0b00000011, 0b01100000, 0b01111111,
  0b01111111, 0b00000011, 0b01100000, 0b01111111,
  0b00000000, 0b00000011, 0b01111111, 0b01100000,
  0b00000011, 0b01111111, 0b01100000, 0b00000000,
  //6
  0b01111111, 0b01100011, 0b01100000, 0b01111111,
  0b01111111, 0b01100011, 0b01100000, 0b01111111,
  0b00000000, 0b01100011, 0b01111111, 0b01100000,
  0b01100011, 0b01111111, 0b01100000, 0b00000000,
  //7
  0b00000011, 0b00000011, 0b00000011, 0b01111111,
  0b00000011, 0b00000011, 0b00000011, 0b01111111,
  0b00000000, 0b00000011, 0b00000011, 0b00000011,
  0b00000011, 0b00000011, 0b00000011, 0b00000000,
  //8
  0b01111111, 0b01100011, 0b01100011, 0b01111111,
  0b01111111, 0b01100011, 0b01100011, 0b01111111,
  0b00000000, 0b01100011, 0b01111111, 0b01100011,
  0b01100011, 0b01111111, 0b01100011, 0b00000000,
  //9
  0b01111111, 0b00000011, 0b01100011, 0b01111111,
  0b01111111, 0b00000011, 0b01100011, 0b01111111,
  0b00000000, 0b00000011, 0b01111111, 0b01100011,
  0b00000011, 0b01111111, 0b01100011, 0b00000000,
};
//////////////////////////////////////////////////////////////

void
p10_controller::p10_clr() {
  memset(virtual_screen, 0, BUFF_SIZE);
}
//////////////////////////////////////////////////////////////

//todo calculate these values
static const uint8_t yr_vals[BYTES_IN_GROUP] = {
  51, 3, 19, 35,
  50, 2, 18, 34,
  49, 1, 17, 33,
  48, 0, 16, 32
};

void
p10_controller::p10_set_pixel(uint32_t x, uint32_t y) {
  uint8_t yr = pgm_read_byte(&yr_vals[y]);
  uint8_t xr = yr + ((x / 8) * 4);
  screen_buffer[xr] |= (1 << (x % 8));
}
//////////////////////////////////////////////////////////////

void
p10_controller::p10_clr_pixel(uint32_t x, uint32_t y) {

}
//////////////////////////////////////////////////////////////
